# Задание
Настроить консул (использовать уже готовую роль и инветори). База данных должна быть проинициализирована на выделенных дисках (в Vargrantfile они уже подключены). БД должна находить в папке /pgsql/pg_data/14. WAL архивы должны находить в папке /pgsql/pg_wal/14. В эти папки должны быть примонтированы диски /dev/sdb и /dev/sdc соответственно. Диски должны быть подключены в LVM и отформатированы в файловой системе xfs.
На серверах pg1 и pg2 настроить оркестратор репликации Patroni (пакет в архиве).
С помощью утилиты vip-manager обеспечить настройку VIP адреса на мастер сервере. vip-manager. Напоминаю, что в конфиге vip-manager необходимо настроить подключение по DCS Consul. IP адрес подключения 127.0.0.1:8500. Так же нужно будет указать consul_token, переменную которого можно взять в роли consul

# Запуск Ansible Playbook
Две легких команды помогут в этом:

```
vagrant up (поднимаем наши серваки)
```
Следом запускаем consul.play
```
ansible-playbook consul.play
```
Тут могут возникнуть технические шоколадки. Их решение ищите в разделе.

```
ansible-playbook *название_вашего_сценария*.yml
```

## Для решения технических шоколадок
1) Проверяем обязательно, нет ли конфликтов в VirtualBox (похожие задания с прошлого семестра нам мешают). Удаляем все ненужное.
2) Не забудьте поменять имя компьютера в vagrantfile (с mario на sirius).
3) Установите модуль для ansible
```
ansible-galaxy collection install community.general
```
4) Можно радикально воспользоваться командой: 
```
vagrant destroy --force
```
!! Если проблемы вознакают на vagrant up. Но обычно все решается с помощью первого пункта. !!

5) Проверьте работу дисков в clients
*Во всех остальных случаях приходите жаловаться Никите. Вам обязательно помогут!*

## Смотрим patronictl

На первом клиенте:
<a href="https://ibb.co/JQJfR5M"><img src="https://i.ibb.co/6BC3Rgf/2022-04-14-20-20-31.png" alt="2022-04-14-20-20-31" border="0"></a>

На втором клиенте:
<a href="https://ibb.co/10gcRZf"><img src="https://i.ibb.co/Fhrp86b/2022-04-14-20-32-15.png" alt="2022-04-14-20-32-15" border="0"></a>

## Готово, вы потрясающие!