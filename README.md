# Задание
Имеется 2 сервера: web1 и web2. На каждый из них следует установить nginx. Еще 2 сервера: haproxy1 и haproxy2, тут уже необходимо настроить отказоустойчивую связку HAProxy и keepalive. C помощью keepalive также настраиваем VIP как по скинутой схеме:

На серверах web1/2 NGINX работает на портах 8080, каждому серверу нужна кастом страница, которая поможет понять, на каком из них мы находимся.
Для haproxy NGINX нужен для балансировки серверов в режиме round-robin. Тут же настраиваем ожидание ответов от web1 и web2 не более 2 секунд.
Также необходимо написать ansible сценарий (playbook), который будет устанавливать и настраивать ПО серверов.

# Запуск Ansible Playbook
Две легких команды помогут в этом:

```
vagrant up (поднимаем наши серваки)
```
```
ansible-playbook *название_вашего_сценария*.yml
```

## Для решения технических шоколадок
1) Проверяем обязательно, нет ли конфликтов в VirtualBox (похожие задания с прошлого семестра нам мешают). Удаляем все ненужное.
2) Не забудьте поменять имя компьютера в vagrantfile (с mario на sirius).
3) Проверяйте правильность написания playbook-а и html.j2 файла. Многие проблемы возникают из-за них.
4) Можно радикально воспользоваться командой: 
```
vagrant destroy --force
```
!! Если проблемы вознакают на vagrant up. Но обычно все решается с помощью первого пункта. !!

5) Проверьте написание части keepalive и задержку на нем.
6) Проверьте сценарий запуска haproxy

*Во всех остальных случаях приходите жаловаться Никите. Вам обязательно помогут!*

## Случаи, когда хочется что-то поменять в настройках

Обязательно вырубает наши виртуалки/серваки с помощью команды
```
vagrant halt
```
Лишь потом приступаем к изменениям (надежнее через mcedit *название_файла* в терминале). 
После вновь запускаем серваки и playbook.

## Вырубаем haproxy1/haproxy2 для проверки балансировки

```
vagrant halt haproxy1/2
```

## Работа web1

> Все включено

<a href="https://ibb.co/VHFR6bC"><img src="https://i.ibb.co/hXGb0rd/photo5364279544590220500.jpg" alt="photo5364279544590220500" border="0"></a>

> Выключен haproxy1

<a href="https://ibb.co/hZXYzV3"><img src="https://i.ibb.co/TbKW3t9/photo5364279544590220501.jpg" alt="photo5364279544590220501" border="0"></a>

> Выключен haproxy2

<a href="https://ibb.co/87nW677"><img src="https://i.ibb.co/jr9cgrr/photo5364279544590220502.jpg" alt="photo5364279544590220502" border="0"></a>

## Работа web2

> Все включено

<a href="https://ibb.co/86TGXFB"><img src="https://i.ibb.co/MMWK9qh/photo5364279544590220504.jpg" alt="photo5364279544590220504" border="0"></a>

> Выключен haproxy1

<a href="https://ibb.co/Hnck3Dg"><img src="https://i.ibb.co/syTMzv3/photo5364279544590220505.jpg" alt="photo5364279544590220505" border="0"></a>

> Выключен haproxy2

<a href="https://ibb.co/yF6nqSw"><img src="https://i.ibb.co/9Hb9WtF/photo5364279544590220503.jpg" alt="photo5364279544590220503" border="0"></a>


# Кастомные странички

*Чтоб закастомить: меняйте текст в html. А то че как не родные, у всех CentOS описан. PS Русский язык не работает*

1) Web1 - вводим в любом браузере ip адрес и порт 8080. Иначе ничего не запустится и будет грустно :(

<a href="https://ibb.co/tLLXQtt"><img src="https://i.ibb.co/TWWLYSS/photo5364279544590220499.jpg" alt="photo5364279544590220499" border="0"></a>

2) Web2 - вводим ip адрес этого сервака (тоже с портом 8080) или зажимаем CTRL + F5 (нажимаем обязательно Fn, если вы на ноутбуке Honor) на главном серваке. Черная магия!

<a href="https://ibb.co/qgRbzwX"><img src="https://i.ibb.co/NNLwXzQ/photo5364279544590220498.jpg" alt="photo5364279544590220498" border="0"></a>
